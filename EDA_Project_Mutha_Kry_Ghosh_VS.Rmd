---
title: "Analysis of power generation across USA in 2021"
author: "Srishti Mutha, Sokna Kry, Samriddha Ghosh, Nagarajan Vaidya Subramanian"
date: "Spring 2023"
output:
  pdf_document: default
  word_document: default
  html_document:
    df_print: paged
geometry: margin=2.54cm
fig_caption: yes
---
####LIST OF TABLES:
#Table 1:Summary Statistics for Variables per Region
#Table 2: Summary Statistics of Pollutants Emitted per Region
#Table 3: Summary Statistics of Energy Sources Per Region

####LIST OF FIGURES:
#Figure 1: Distribution of Energy Sources by Region in 2021
#Figure 2: Distribution of different renewable energy generation sources across BEA regions of USA in 2021
#Figure 3: Plot of total CO2 and CO2e emissions across BEA regions of USA in 2021
#Figure 4: Carbon dioxide emissions in each BEA region in the USA in 2021
#Figure 5: Sulfur dioxide emissions in each BEA region in the USA in 2021
#Figure 6: Nitrogen oxide emissions in each BEA region in the USA in 2021
#Figure 7: Carbon dioxide equivalent emissions in each BEA region in the USA in 2021
#Figure 8: Linear Regression plot of Annual Net Energy Generation and CO2 emissions 
#Figure 9: Linear Regression plot of Annual Net Energy Generation and CO2e emissions 
#Figure 10: Linear Regression plot of Annual Net Energy Generation and SO2 emissions
#Figure 11: Linear Regression plot of Annual Net Energy Generation and NOX emissions
#Figure 12: Plot showing the correlation between explanatory and response variables for Model 1
#Figure 13: Plot showing the correlation between explanatory and response variables for Model 2
#Figure 14: Plot showing the correlation between explanatory and response variables for Model 3

```{r installing packages, include=FALSE}
if(!require(knitr)) {
  install.packages("knitr")
  require(knitr)
}

if(!require(psych)) {
  install.packages("psych")
  require(psych)
}

if(!require(tidyverse)) {
  install.packages("tidyverse")
  require(tidyverse)
}

if(!require(gt)) {
  install.packages("gt")
  require(gt)
}
#dependency of gt
if(!require(xfun)) {
  install.packages("xfun")
  require(xfun)
}

if(!require(GGally)) {
  install.packages("GGally")
  require(GGally)
}
```


```{r setup, include=FALSE}
# Set your working directory
getwd()
# Load your packages
library(knitr) #library of code that helps make pretty rendered docs
library(psych) #really only here for the skew function for summary stats
library(tidyverse) #dplyr, ggplot, and a bunch of other useful libraries
library(gt) #to make pretty looking summary tables
library(GGally)

# Set your ggplot theme
my_theme <- theme_minimal() +
  theme(
    legend.position = "bottom",
    legend.title = element_text(colour = "#440000"),
    plot.title = element_text(colour = "blue",
                              hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    axis.title = element_text(colour = "#4169e1")
  )
theme_set(my_theme)
# Load your datasets
#Source of data is eGRID 2021, accessible from EPA's website at:
#https://www.epa.gov/system/files/documents/2023-01/eGRID2021_data.xlsx
egrid2021 <- readxl::read_xlsx(path = "./Data/Raw/eGRID2021_data.xlsx",
                               sheet = "ST21",
                               skip = 1)

#eGRID is a huge dataset with several data fields and we will only be using a subset of them.
#so this next line is to subset the database and select only those fields that we will be working with.
egrid_subset <- egrid2021 %>%
  select(PSTATABB, STNAMEPCAP, STNGENAN, STNOXAN, STSO2AN, STCO2AN,
         STCO2EQA, STGENACL, STGENAOL, STGENAGS, STGENANC, STGENAHY,
         STGENABM, STGENAWI, STGENASO, STGENAGT, STGENAOF, STGENATR, STGENATN)

#Creating a new blank column to represent the region that each state is from
#based on the classification system used by Bureau of Economic Analysis
egrid_subset <- egrid_subset %>%
  add_column(.before = "PSTATABB",
             Region = "blank")

#Source for the following classification of states into regions:
#https://apps.bea.gov/regional/docs/msalist.cfm?mlist=2
NewEngland <- c("CT", "ME", "MA", "NH", "RI", "VT")
MidEast <- c("DE", "DC", "MD", "NJ", "NY", "PA")
GreatLakes <- c("IL", "IN", "MI", "OH", "WI")
Plains <- c("IA", "KS", "MN", "MO", "NE", "ND", "SD")
SouthEast <- c("AL", "AR", "FL", "GA", "KY", "LA", "MS", "NC", "SC", "TN", "VA", "WV")
SouthWest <- c("AZ", "NM", "OK", "TX")
RockyMountain <- c("CO", "ID", "MT", "UT", "WY")
FarWest <- c("CA", "NV", "OR", "WA")

#this next one is not a classification used by BEA but one that is useful for analysing this dataset
NonContiguous <- c("AK", "HI", "PR") 

egrid_subset$Region[egrid_subset$PSTATABB %in% NewEngland] <- "New England"
egrid_subset$Region[egrid_subset$PSTATABB %in% MidEast] <- "Mid East"
egrid_subset$Region[egrid_subset$PSTATABB %in% GreatLakes] <- "Great Lakes"
egrid_subset$Region[egrid_subset$PSTATABB %in% Plains] <- "Plains"
egrid_subset$Region[egrid_subset$PSTATABB %in% SouthEast] <- "South East"
egrid_subset$Region[egrid_subset$PSTATABB %in% SouthWest] <- "South West"
egrid_subset$Region[egrid_subset$PSTATABB %in% RockyMountain] <- "Rocky Mountain"
egrid_subset$Region[egrid_subset$PSTATABB %in% FarWest] <- "Far West"
egrid_subset$Region[egrid_subset$PSTATABB %in% NonContiguous] <- "Non-Contiguous"

egrid_subset$Region == "blank" #verifying that all states have been categorized

#uncomment this code when there's any changes to the subsetting
#write.csv(egrid_subset, file = "./Data/Processed/egrid2021_st21_processed.csv")

```

```{r adding and wrangling new datasets, include=FALSE}
#Median Air Quality Index, obtained from the US EPA for 2021
aqi <- readxl::read_xlsx(path = './Data/Raw/US EPA - Annual AQI by County 2021.xlsx',
                         skip = 1) %>%
  rename(medAQI = 'Median AQI') %>%
  group_by(State) %>%
  summarise(medianAQI = median(medAQI))

#Median Household income in 2020 in 2020 inflation-adjusted dollars, obtained from US Census 2020 5-year estimates
medianHHI <- readxl::read_xlsx(path = './Data/Raw/US Census - Median Household Income 2020.xlsx',
                               sheet = 'Data') %>%
  rename('Criterion' = '...1') %>%
  subset(Criterion == "Median income (dollars)") %>%
  pivot_longer(cols = -c('Criterion'),
               names_to = 'State',
               values_to = 'medianHHI') %>%
  select(-c('Criterion'))

#Sex ratio across states, obtained from US Census 2020 5-year estimates
sexratio <- readxl::read_xlsx(path = './Data/Raw/US Census - Age and Sex Ratio 2021.xlsx',
                              sheet = 'Data') %>%
  rename('Criterion' = '...1') %>%
  subset(Criterion == "Sex ratio (males per 100 females)") %>%
  pivot_longer(cols = -c('Criterion'),
               names_to = 'State',
               values_to = 'SexRatio') %>%
  select(-c('Criterion'))

#Percent of population with a high school degree or higher, from US Census 2020 5-year estimates
education <- readxl::read_xlsx(path = './Data/Raw/US Census - Education 2020.xlsx',
                               sheet = 'Data') %>%
  rename('Criterion' = '...1') %>%
  subset(Criterion == "High school graduate (includes equivalency)") %>%
  pivot_longer(cols = -c('Criterion'),
               names_to = 'State',
               values_to = 'pctEducation') %>%
  select(-c('Criterion'))

#Deaths per 100,000 residents, from US CDC for 2021 
deathrate <- readxl::read_xlsx(path = './Data/Raw/US CDC - Death Rate 2021.xlsx',
                               skip = 1) %>%
  rename('State' = 'State/Territory',
         'DeathRate' = 'Death Rate') %>%
  select(State, DeathRate)

stateabb <- readxl::read_xlsx(path = './Data/Raw/US SSA - 2 Letter State Abbreviations.xlsx',
                              skip = 1)

#merging these datasets with subset of eGRID for developing linear models
dataset_final <- merge(stateabb, egrid_subset,
                       by = 'PSTATABB',
                       all.y = TRUE) %>%
  merge(aqi) %>%
  merge(medianHHI) %>%
  merge(sexratio) %>%
  merge(education) %>%
  merge(deathrate) %>%
  mutate(pctRene = STGENATR/STNGENAN,
         medianHHI = as.numeric(medianHHI),
         SexRatio = as.numeric(SexRatio),
         pctEducation = as.numeric(pctEducation),
         DeathRate = as.numeric(DeathRate))

# write.csv(dataset_final, file = './Data/Processed/Final Merged Dataset.csv')
```

### Rationale and Research Questions

The US has been transitioning towards a greater reliance on renewable energy sources such as wind, solar, hydro power and many more technologies. Analyzing the e-Grid data can provide insights into the distribution of clean energy generation across US, performance of these renewable energy sources, their impact on the electricity generation and energy markets throughout USA, and whether they are meeting the expectations of energy companies, policymakers, and consumers. 

This project aims to use e-GRID 2021 (published January 2023) to answer the following research questions:

1. What is the distribution of electricity generation across the Bureau of Economic Analysis regions in the US, from both the renewable and non-renewable energy sources?
2. What is the distribution of generation from each type of renewable and non-renewable energy sources across Bureau of Economic Analysis regions in the US?
3. Greenhouse gas emissions across Bureau of Economic Analysis regions in the US from electricity generators. 
4. Summary statistics of generators across the Bureau of Economic Analysis regions in the US, in terms of fuel source, nameplate capacity, annual net generation, and pollutants emitted?
5. Is there correlation between energy generators and pollutants emitted? 

These analyses will be performed by aggregating the states into categories as done by the Bureau of Economic Analysis which divides the states into 8 regions. We have added an additional "Non-Contiguous" category to represent states in the e-GRID dataset that are not part of mainland USA.

\newpage

### Dataset Information
The Emissions & Generation Resource Integrated Database (e-GRID) is a comprehensive source of data published by the Environment Protection Agency of the US Government.  This database describes various technical and environmental parameters of all electric power plants in the US, and is published annually. It includes emissions, emission rates, generation, heat input, resource mix, and many other attributes. eGRID is typically used for greenhouse gas registries and inventories, carbon footprints, consumer information disclosure, emission inventories and standards, power market changes, and avoided emission estimates.In our project we have used the e-Grid 2021 data-set which was released on January 30th, 2023. 

Below are some summary statistics of the installed capacity and annual generation per region, pollutants and their CO2 equivalents per region, and lastly about the distribution of annual generation across different renewable and non-renewable sources of energy.

\newpage


### Exploratory Analysis 

```{r summary.stats, include=FALSE}

#summary stats of total nameplate capacity and annual generation per region
summary.plants <- egrid_subset %>%
  select(Region, STNAMEPCAP, STNGENAN) %>%
  rename("State nameplate capacity (GW)" = STNAMEPCAP,
         "State annual net generation (GWh)" = STNGENAN) %>%
  pivot_longer(cols = c("State nameplate capacity (GW)",
                        "State annual net generation (GWh)"),
               names_to = "variable", values_to = "value") %>%
  group_by(Region, variable) %>%
  summarise(obs = length(value[!is.na(value)]),
            min = round(min(value/1000, na.rm = TRUE), 2),
            max = round(max(value/1000, na.rm = TRUE), 2),
            mean = round(mean(value/1000, na.rm =TRUE), 2),
            median = round(median(value/1000, na.rm =TRUE), 2),
            sd = round(sd(value/1000, na.rm =TRUE), 2),
            skewness = round(skew(value/1000,na.rm = TRUE), 2))

#summary stats of region-wise emission of different pollutants and the CO2 equivalents
 
summary.pollution <- egrid_subset %>%
  select(Region, STNOXAN, STSO2AN, STCO2AN, STCO2EQA) %>%
  rename("State annual NOx emissions (tons)" = STNOXAN,
         "State annual SO2 emissions (tons)" = STSO2AN,
         "State annual CO2 emissions (tons)" = STCO2AN,
         "State annual CO2 equivalent emissions (tons)" = STCO2EQA) %>%
  pivot_longer(cols = c("State annual NOx emissions (tons)",
                        "State annual SO2 emissions (tons)",
                        "State annual CO2 emissions (tons)",
                        "State annual CO2 equivalent emissions (tons)"),
               names_to = "variable", values_to = "value") %>%
  group_by(Region, variable) %>%
  summarise(obs = length(value[!is.na(value)]),
            min = round(min(value, na.rm = TRUE), 2),
            max = round(max(value, na.rm = TRUE), 2),
            mean = round(mean(value, na.rm = TRUE), 2),
            median = round(median(value, na.rm=TRUE), 2),
            sd = round(sd(value, na.rm=TRUE), 2),
            skewness = round(skew(value, na.rm = TRUE), 2))

#summary stats of region-wise breakdown of generation by fuel type
summary.fuels <- egrid_subset %>%
  select(Region, STGENACL, STGENAOL, STGENAGS, STGENANC, STGENAHY,
         STGENABM, STGENAWI, STGENASO, STGENAGT, STGENAOF) %>%
  rename("State annual coal net generation (GWh)" = STGENACL,
         "State annual oil net generation (GWh)" = STGENAOL,
         "State annual gas net generation (GWh)" = STGENAGS,
         "State annual nuclear net generation (GWh)" = STGENANC,
         "State annual hydro net generation (GWh)" = STGENAHY,
         "State annual biomass net generation (GWh)" = STGENABM,
         "State annual wind net generation (GWh)" = STGENAWI,
         "State annual solar net generation (GWh)" = STGENASO,
         "State annual geothermal net generation (GWh)" = STGENAGT,
         "State annual other fossil net generation (GWh)" = STGENAOF) %>%
  pivot_longer(cols = c("State annual coal net generation (GWh)",
                        "State annual oil net generation (GWh)",
                        "State annual gas net generation (GWh)",
                        "State annual nuclear net generation (GWh)",
                        "State annual hydro net generation (GWh)",
                        "State annual biomass net generation (GWh)",
                        "State annual wind net generation (GWh)",
                        "State annual solar net generation (GWh)",
                        "State annual geothermal net generation (GWh)",
                        "State annual other fossil net generation (GWh)"),
               names_to = "variable", values_to = "value") %>%
  group_by(Region, variable) %>%
  summarise(obs = length(value[!is.na(value)]),
            min = round(min(value/1000, na.rm = TRUE), 2),
            max = round(max(value/1000, na.rm = TRUE), 2),
            mean = round(mean(value/1000, na.rm=TRUE), 2),
            median = round(median(value/1000, na.rm=TRUE), 2),
            sd = round(sd(value/1000, na.rm=TRUE), 2),
            skewness = round(skew(value/1000, na.rm = TRUE), 2))

```

```{r summary.tables, include=FALSE}
summary.table.plants <- summary.plants %>%
  gt() %>%
    tab_options(table.width = pct(95)) %>%
    cols_width(c(variable)~ px(200),
               everything()~ px(120) )%>%

  tab_header(
    title = md("Table 1: Summary Statistics for Variables per Region")) %>%

  fmt_passthrough (columns=c(Region)) %>%
  fmt_number(columns=c(obs), decimals=0) %>%

  fmt_number(
    columns = 3:7,
    rows = all(),
    n_sigfig = 1,
    sep_mark = ",") %>%

  cols_label(variable="Variable",
    obs = "Number of States",
    min = "Minimum",
    max = "Maximum",
    mean = "Mean",
    median="Median",
    sd = "Standard Deviation",
    skewness = "Skewness")

summary.table.plants

summary.table.pollution <- summary.pollution %>%
  gt() %>%
    tab_options(table.width = pct(95)) %>%
    cols_width(c(variable)~ px(200),
               everything()~ px(120) )%>%

  # tab_header(
  #   title = md("Table 2: Summary Statistics of pollutants emitted per Region")) %>%

  fmt_passthrough (columns=c(Region)) %>%
  fmt_number(columns=c(obs), decimals=0) %>%

  fmt_number(
    columns = 3:7,
    rows = all(),
    n_sigfig = 1,
    sep_mark = ",") %>%

  cols_label(variable="Variable",
    obs = "Observations",
    min = "Minimum",
    max = "Maximum",
    mean = "Mean",
    median="Median",
    sd = "Standard Deviation",
    skewness = "Skewness")

summary.table.pollution

summary.table.fuels <- summary.fuels %>%
  gt() %>%
    tab_options(table.width = pct(95)) %>%
    cols_width(c(variable)~ px(200),
               everything()~ px(120) )%>%

  # tab_header(
  #   title = md("Table 3: Summary Statistics of Energy Sources Per Region")) %>%

  fmt_passthrough (columns=c(Region)) %>%
  fmt_number(columns=c(obs), decimals=0) %>%

  fmt_number(
    columns = 3:7,
    rows = all(),
    n_sigfig = 1,
    sep_mark = ",") %>%

  cols_label(variable="Variable",
    obs = "Observations",
    min = "Minimum",
    max = "Maximum",
    mean = "Mean",
    median="Median",
    sd = "Standard Deviation",
    skewness = "Skewness")

summary.table.fuels

```

\newpage
### Analysis
#### Question 1: What is the distribution of electricity generation across the Bureau of Economic Analysis regions in the US, from both the renewable and non-renewable energy sources?

The first research question focuses on the distribution of electricity generation from renewable and non-renewable energy sources among the Bureau of Economic Analysis (BEA) regions in the United States. The BEA divides the United States into eight regions, which are:

1. New England
2. Mideast
3. Great Lakes
4. Plains
5. Southeast
6. Southwest
7. Rocky Mountain
8. Far West

The purpose of this question is to gain a deeper understanding of the power production in different regions of the US and the types of energy sources used. This data can aid policymakers and analysts in identifying potential opportunities to increase the use of renewable energy sources and decrease reliance on non-renewable sources, such as coal and natural gas, which are known to contribute to greenhouse gas emissions and climate change. Additionally, the data can assist companies and investors in locating potential markets for renewable energy products and services.

In order to determine the distribution of electricity generation across the BEA regions in the USA, the states were grouped together based on their respective regions. The state-wise annual electricity generation was aggregated to obtain the region-wise annual generation. To better visualize and compare the electricity generation across different regions, we graphed the data in bar plots. 

```{r Research.Question.1, include=FALSE}

generation_rene<-aggregate(egrid_subset$STGENATR, by=list(egrid_subset$Region), FUN=sum)
generation_rene

generation_nonrene<-aggregate(egrid_subset$STGENATN , by=list(egrid_subset$Region), FUN=sum)
generation_nonrene

colnames(generation_rene) <- c("Region", "Total renewable generation (MWh)")
colnames(generation_nonrene) <- c("Region", "Total non-renewable generation (MWh)")

#bar plot
energy.sources <- merge(generation_rene, generation_nonrene) %>%
  pivot_longer(cols = c("Total renewable generation (MWh)", "Total non-renewable generation (MWh)"),
               names_to = "source",
               values_to = "values") %>%
  mutate(source = as.factor(source))

energy.sources.plot <- energy.sources %>%
    ggplot(mapping = aes(x = Region,
                         y = values,
                         fill = source)) +
    geom_bar(stat = "identity",
             position = 'dodge') +
    labs(title = "Distribution of Energy Sources by Region in 2021",
         x = "Regions",
         y = "Total Power Generation (MWh)") +
    theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
ggsave(filename = "./Plots/Q1_energy_sources_plot.png",
       plot = energy.sources.plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')

```

Figure 1: Distribution of Energy Sources by Region in 2021
```{r Q1plot, echo=FALSE, fig.align='center'}
energy.sources.plot
```


#### Question 2: What is the distribution of generation from each type of renewable energy sources across Bureau of Economic Analysis regions in the US?

The second research question looks deeper into the distribution of electricity generation from each type of renewable energy source across the BEA regions of the US. Renewable energy sources include solar, wind, hydro, geothermal, and biomass.

The purpose of this question is to gain a better understanding of how different regions in the United States are utilizing various renewable energy sources for electricity generation. The data obtained can be useful in identifying the potential for growth in the use of renewable energy sources in certain regions and identifying areas where investments in renewable energy infrastructure and technology may be needed. It can be crucial data for policymakers to develop policies and regulations that encourage the growth of specific renewable energy across USA. The potential opportunities for growth and expansion of renewable energy plants into regions that have high potential can also be evaluated using this data. Additionally, this information can be useful for identifying regions where investments in renewable energy infrastructure could be profitable. 

In order to determine the distribution of electricity generation from each type of renewable energy sources across BEA regions in the US, the states were grouped together based on their respective regions. The state annual generation values for each type of renewable source were aggregated to obtain the annual electricity generation. This enabled us to obtain the total electricity generation for each type of renewable energy source for each region, annually.

```{r Research.Question.2, include=FALSE}

distribution_rene<-aggregate(cbind(STGENAHY,STGENABM,STGENAWI,STGENASO,STGENAGT) ~ Region,data=egrid_subset, FUN=sum)
colnames(distribution_rene) <- c("Region","Hydro-power generation (MWh)","Biomass generation (MWh) ","Wind generation (MWh)","Solar generation (MWh)","Geothermal generation (MWh)")

table.annualgen <- kable(distribution_rene, align = c("l", rep("c", 7)))

distribution_nonrene<-aggregate(cbind(STGENACL,STGENAOL,STGENAGS,STGENANC) ~ Region,data=egrid_subset, FUN=sum)
distribution_nonrene

colnames(distribution_nonrene) <- c("Region","Coal generation (MWh)","Oil generation (MWh)","Natural Gas generation (MWh)","Nuclear generation (MWh)")


kable(distribution_nonrene, align = "c")
kable(distribution_rene, align = "c")

#stacked bar plots to show distribution of different renewable energy sources across the BEA regions of USA in 2021

renewable_energy_plot<-
  egrid_subset%>%
  select(Region,STGENAHY,STGENABM,STGENAWI,STGENASO,STGENAGT)%>%
  group_by(Region)%>%
  #mutate(STCO2EQA = STCO2EQA - STCO2AN) %>%
  summarise("Total Hydro-electric generation" = sum(STGENAHY),
            "Total Biomass generation" = sum(STGENABM),
            "Total Wind power generation" = sum(STGENAWI),
            "Total Solar power generation" = sum(STGENASO),
            "Total Geothermal power generation" = sum(STGENAGT)) %>%
  pivot_longer(cols = c("Total Hydro-electric generation",
                        "Total Biomass generation",
                        "Total Wind power generation",
                        "Total Solar power generation",
                        "Total Geothermal power generation"),
               names_to = "variable",
               values_to = "values") %>%
  ggplot(mapping = aes(x = Region,
                       y = values,
                       fill = variable)) +
    geom_bar(stat = "identity",
             position = position_stack(reverse = TRUE)) +
    labs(title = "Different renewable energy generations across regions in 2021",
         x = "Regions",
         y = "Generation (MWh)",
         fill = "Generation category") +
    theme(axis.text.x = element_text(angle = 45, hjust = 0.75))

ggsave(filename = "./Plots/Q2_renewable_energy_plot.png",
       plot = renewable_energy_plot,
       dpi = 'retina',
       device = 'png')
```

Figure 2: Distribution of different renewable energy generation sources across BEA regions of USA in 2021
```{r Q2plot, echo=FALSE, fig.cap="Different renewable energy generations across regions in 2021", fig.align='center'}
renewable_energy_plot
```
#### Question 3: Greenhouse gas emissions across Bureau of Economic Analysis regions in the US from electricity generators.

This question delves into greenhouse gas emissions from electricity generators across the BEA regions in the US. Greenhouse gases, such as carbon dioxide, methane, nitrous oxide, sulfur dioxide and many more are released into the atmosphere as a result of the combustion of fossil fuels for electricity generation, which contributes to climate change.

The purpose of this question is to understand the level of greenhouse gas emissions from electricity generation in each region and to identify areas where there may be opportunities to reduce greenhouse gas emissions. 

Analysts can make use of this data to gain insights into the sources and levels of greenhouse gas emissions from electricity generators in each region and help in the development of strategies for reducing emissions. Policymakers across USA need this data to comprehend the necessity to develop policies and regulations that encourage the transition to clean energy sources and the reduction of greenhouse gas emissions from electricity generators, such as carbon pricing or cap-and-trade programs. This information is also crucial to identify regions where investments in renewable energy infrastructure, technology and operations may impact the environment. 

In order to determine the greenhouse gas emissions across BEA regions in the US from electricity generators, 

```{r Research.Question.3, include=FALSE}
pollutants.plot <- 
  egrid_subset %>%
  select(Region, STCO2EQA, STCO2AN) %>%
  group_by(Region) %>%
  mutate(STCO2EQA = STCO2EQA - STCO2AN) %>%
  summarise("Total CO2 emissions" = sum(STCO2AN),
            "Total CO2 equivalents emissions" = sum(STCO2EQA)) %>%
  pivot_longer(cols = c("Total CO2 emissions",
                        "Total CO2 equivalents emissions"),
               names_to = "variable",
               values_to = "values") %>%
  ggplot(mapping = aes(x = Region,
                       y = values,
                       fill = variable)) +
    geom_bar(stat = "identity",
             position = position_stack(reverse = TRUE)) +
    labs(title = "Total CO2 and CO2 eq emissions across regions in 2021",
         x = "Regions",
         y = "Emissions (tons)",
         fill = "Emission category") +
    theme(axis.text.x = element_text(angle = 45, hjust = 0.75))

ggsave(filename = "./Plots/Q3_pollutants_plot.png",
       plot = pollutants.plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')
```

Figure 3: Plot of total CO2 and CO2e emissions across BEA regions of USA in 2021
```{r Q3plot, echo=FALSE, fig.cap="Total CO2 and CO2 eq emissions across regions in 2021", fig.align='center'}
pollutants.plot
```


#### Question 4: Summary statistics of generators across the Bureau of Economic Analysis regions in the US, in terms of fuel source, nameplate capacity, annual net generation, and pollutants emitted

The summary statistics on electricity generators across the BEA regions in the United States covers information such as the type of fuel source used, the nameplate capacity of the generators, the annual net generation of electricity, and the amount of pollutants emitted. We performed some statistical analyses to obtain more insights. Boxplots are used for summary statistics of this question as they are the most appropriate visualization to understand the distribution of annual net generation of electricity in different regions and the pollutants. They provide a reliable way to compare medians, ranges, spread of data, and identify potential outliers, and are more effective at communicating this information than violin plots or scatter plots.

Looking at the plots for each region, we can see that the highest median of pollutants is in the Great Lakes region, while the lowest is in New England. Additionally, there is a potential outlier in the data for the South West region.

obtain a comprehensive understanding of the electricity generation infrastructure across different regions in the United States, to facilitate the identification of opportunities for investment in renewable energy infrastructure, evaluate the environmental impact of electricity generation in each region, and to develop policies and regulations that encourage the reduction of harmful emissions.


```{r Research Question 4, include=FALSE}
# Boxplot
CO2_Plot <- ggplot(egrid_subset, aes(x = Region, y = STCO2AN)) + 
  geom_boxplot()+
  labs (title= expression(paste("CO"[2]~"Emissions in each Region in the USA in 2021")), 
        y= expression(paste("CO"[2]~"Emissions (tons)")),
        x= "Regions") +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
ggsave(filename = "./Plots/Q4_CO2_Plot.png",
       plot = CO2_Plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')

SO2_Plot <- ggplot(egrid_subset, aes(x = Region, y = STSO2AN)) + 
  geom_boxplot()+
  labs (title= expression(paste("SO"[2]~"Emissions in each Region in the USA in 2021")), 
        y= expression(paste("SO"[2]~"Emissions (tons)")),
        x= "Regions") +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
ggsave(filename = "./Plots/Q4_SO2_Plot.png",
       plot = SO2_Plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')

NOX_Plot<-ggplot(egrid_subset, aes(x = Region, y = STNOXAN)) + 
  geom_boxplot()+
  labs (title= expression(paste("NO"[X]~"Emissions in each Region in the USA in 2021")), 
        y= expression(paste("NO"[X]~"Emissions (tons)")),
        x= "Regions")+
  theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
ggsave(filename = "./Plots/Q4_NOX_Plot.png",
       plot = NOX_Plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')

CO2EQA_Plot<-ggplot(egrid_subset, aes(x = Region, y = STCO2EQA)) + 
  geom_boxplot()+
  labs (title= expression(paste("CO"[2]~"EQ Emissions in each Region in the USA in 2021")), 
        y= expression(paste("CO"[2]~"EQ Emissions (tons)")),
        x= "Regions")+
  theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
ggsave(filename = "./Plots/Q4_CO2EQA_Plot.png",
       plot = CO2EQA_Plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')
```

Figure 4: Carbon dioxide emissions in each BEA region in the USA in 2021
```{r Q4plot_CO2, echo=FALSE, fig.align='center'}
CO2_Plot
```

Figure 5: Sulfur dioxide emissions in each BEA region in the USA in 2021
```{r Q4plot_SO2, echo=FALSE, fig.align='center'}
SO2_Plot
```

Figure 6: Nitrogen oxide emissions in each BEA region in the USA in 2021
```{r Q4plot_NOX, echo=FALSE, fig.align='center'}
NOX_Plot
```

Figure 7: Carbon dioxide equivalent emissions in each BEA region in the USA in 2021
```{r Q4plot_CO2e, echo=FALSE, fig.align='center'}
CO2EQA_Plot
```

#### Question 5: Is there correlation between energy generators and pollutants emitted? 

We wanted to understand the correlation between electricity generation and the quantity of different pollutants that are emitted. First, we developed linear regression models to understand the impact that electricity generation has on the emissions of different pollutants (so four linear regression models with one explanatory variable each). The type of fuel source used by a generator affects the amount and type of pollutants that are emitted during power generation. Power plants that use non-renewable fuels such as coal, oil, and natural gas emit pollutants such as carbon dioxide, methane, sulfur dioxide, nitrogen oxides, and many more, majorly contribute to climate change and air pollution.

Through this question we try to find this correlation between energy generators and the pollutants they emit. The information can be used to inform policy decisions related to reducing harmful emissions, such as setting emissions standards or incentives to increase the use of cleaner energy sources. It can also be useful for businesses to evaluate the environmental impact of their operations and to identify opportunities to reduce their carbon footprint. Understanding the correlation between energy generators and pollutants emitted can provide insights into the environmental impact of different types of energy sources and can be used by energy analysts in models for predicting future emissions trends. 

The hypotheses for our models are as follows:
$H_o$: There is no correlation between energy generation and pollutants emitted.
$H_a$: There is some correlation between energy generation and pollutants emitted.

The four models all had a p-value of <0.001 indicating that the models had some explanatory power. We can therefore reject the null hypothesis for all four models and conclude that there is some correlation between energy generation and pollutants emitted.

Our models had different R2 values though. Annual electricity generation is able to explain 63% of the variance in NO~x~ emissions and only under 42% of $SO_2$ emissions. Whereas it explains 82% of the variance in emissions of $CO_2$ and $CO_2$-equivalents.
Further, the $\beta$ coefficients for the first two models (between electricity generation and $NO_x$ or $SO_2$) are of the order of $10^{-4}$ indicating a very small influence of electricity generation on the quantity of pollutants emitted. Whereas the $\beta$ coefficients for the last two models (between electricity generation and $CO_2$ or $CO_2$-equivalents) are of the order of $10^{-1}$ indicating that electricity generation has a 1000-fold greater impact on $CO_2$ emissions than it does on the other pollutants we looked at.


```{r Research Question 5, echo=FALSE}
#T.Test of annual net energy generations and pollutants emitted 

T_GENOX <- lm(STNOXAN ~ STNGENAN, data = egrid_subset)
summary(T_GENOX)
print("************************************************************")

T_GESO2 <-lm(STSO2AN ~ STNGENAN, data = egrid_subset)
summary(T_GESO2)
print("************************************************************")

T_GECO2 <- lm(STCO2AN ~ STNGENAN, data = egrid_subset)
summary(T_GECO2)
print("************************************************************")

T_GECO2EQA <- lm(STCO2EQA ~ STNGENAN, data = egrid_subset)
summary(T_GECO2EQA)
print("************************************************************")
```

Figure 8: Linear Regression plot of Annual Net Energy Generation and CO2 emissions 
```{r Q5_CO2, echo=FALSE, fig.align='center'}

#Linear Regression plots of Annual Net Energy Generation and different types of pollutants 
ggplot(data = egrid_subset, aes(x = STNGENAN, y = STCO2AN)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Annual Net Energy Generation (MWh)",
       y = "CO2 Emissions (tons)",
       title = "Linear Regression: Annual Net Energy Generation and CO2 Emissions")
```

Figure 9: Linear Regression plot of Annual Net Energy Generation and CO2e emissions 
```{r Q5_CO2e, echo=FALSE, fig.align='center'}
ggplot(data = egrid_subset, aes(x = STNGENAN, y = STCO2EQA)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Annual Net Energy Generation (MWh)",
       y = "CO2 Equivalent Emissions (tons)",
       title = "Linear Regression: Annual Net Energy Generation and CO2 Eq Emissions")
```

Figure 10: Linear Regression plot of Annual Net Energy Generation and SO2 emissions
```{r Q5_SO2, echo=FALSE, fig.align='center'}
ggplot(data = egrid_subset, aes(x = STNGENAN, y = STSO2AN)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Annual Net Energy Generation (MWh)",
       y = "SO2 Emissions (tons)",
       title = "Linear Regression: Annual Net Energy Generation and SO2 Emissions")
```

Figure 11: Linear Regression plot of Annual Net Energy Generation and NOX emissions
```{r Q5_NOX, echo=FALSE, fig.align='center'}
ggplot(data = egrid_subset, aes(x = STNGENAN, y = STNOXAN)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Annual Net Energy Generation (MWh)",
       y = "NOX Emissions (tons)",
       title = "Linear Regression: Annual Net Energy Generation and NOX Emissions")
```

To build on this idea, we wanted to analyse the effects of different parameters on the health of people in different states, we developed three multiple linear regression models. They look at the effect that the consumption of renewable energy has on people's health at the state level instead of the region level so as to get more granular information. We chose the following control variables:
1. air quality (which can make people vulnerable to airborne illnesses),
2. education level (which influences people's awareness of diseases and pollutants),
3. sex ratio (to separate out the predisposition of people of different sex to have different exposures to occupational hazards), and
4. median household income (which affects people's abilities to pay for healthcare)

```{r linear model1, include=FALSE}
#mortality rate ~ aqi + median household income + Renewable energy consumption % + education + sex ratio
model1 <- lm(DeathRate ~ medianAQI + medianHHI + pctRene + pctEducation + SexRatio,
             data = dataset_final)

model1.corplot <- GGally::ggpairs(data = dataset_final, 
                          columns = c('DeathRate', 'medianAQI', 'medianHHI', 'pctRene', 'pctEducation', 'SexRatio'))

```

Figure 12: Plot showing the correlation between explanatory and response variables for Model 1
```{r model1 results, echo=FALSE, fig.align='center'}
summary(model1)
model1.corplot
```

This model has an F-statistic of 15.5 on 5 variables and 45 degrees of freedom, corresponding to a p-value of <0.001. This indicates that we can reject the null hypothesis and conclude that this model has some explanatory power. This set of explanatory variables is able to explain around 63% of the variance in death rate across the US.

The correlation plot shows that we have some clustering of three explanatory variables - median AQI, percentage of total generation from renewables, and sex ratio. To improve the model we explored two transformations for these clustered variables - one being rank-transform and the other being log-transform.

```{r linear model2, include=FALSE}
model2_subset <- dataset_final %>%
  select(DeathRate, medianAQI, medianHHI, pctRene, pctEducation, SexRatio) %>%
  mutate(rank_pctRene = rank(pctRene, ties.method = "average"),
         rank_medianAQI = rank(medianAQI, ties.method = "average"),
         rank_SexRatio = rank(SexRatio, ties.method = "average"))

model2 <- lm(DeathRate ~ rank_medianAQI + medianHHI + rank_pctRene + pctEducation + rank_SexRatio,
             data = model2_subset)

ggplot(data = dataset_final,
       mapping = aes(x = rank(SexRatio, ties.method = "average"),
                     y = DeathRate)) +
  geom_point() +
  geom_smooth(method = 'lm')

model2.corplot <- GGally::ggpairs(data = model2_subset, 
                          columns = c('rank_medianAQI', 'medianHHI', 'rank_pctRene', 'pctEducation', 'rank_SexRatio', 'DeathRate'))
```

Figure 13: Plot showing the correlation between explanatory and response variables for Model 2
```{r model2 results, echo=FALSE, fig.align='center'}
summary(model2)
model2.corplot
```

Using the rank-transformed variables in our model, we get an F-statistic of 14.6 on 5 variables and 45 degrees of freedom, corresponding to a p-value <0.001. This means we can reject the null hypothesis for this model and conclude it has some explanatory power. Looking at the R2 value, we see these explanatory variables can explain under 62%

```{r linear model3, include=FALSE}
model3_subset <- dataset_final %>%
  select(DeathRate, medianAQI, medianHHI, pctRene, pctEducation, SexRatio) %>%
  mutate(log_pctRene = log(pctRene),
         log_medianAQI = log(medianAQI),
         log_SexRatio = log(SexRatio))

model3 <- lm(DeathRate ~ log_medianAQI + medianHHI + log_pctRene + pctEducation + log_SexRatio,
             data = model3_subset)
model3.corplot <- GGally::ggpairs(data = model3_subset, 
                          columns = c('log_medianAQI', 'medianHHI', 'log_pctRene', 'pctEducation', 'log_SexRatio', 'DeathRate'))

```

Figure 14: Plot showing the correlation between explanatory and response variables for Model 3
```{r model3 results, echo=FALSE}
summary(model3)
model3.corplot
```

\newpage

### Summary and Conclusions

In 2021, the energy market in the USA continued to shift towards renewable energy generation, but non-renewable sources still dominated the market. Through our analysis we were able to establish the same. 

Future scope of work would involve comparing the generations and emissions over the next couple of years and understand the trend-line followed in each of these parameters of focus. 




\newpage

### Appendix

```{r summary.table.plants, echo=FALSE, fig.align='center', fig.cap="Table 1: Summary Statistics for Variables per Region"}
summary.table.plants
```

```{r summary.table.pollution, echo=FALSE, fig.align='center', fig.cap="Table 2: Summary Statistics of Pollutants Emitted per Region"}
summary.table.pollution
```

```{r summary.table.fuels, echo=FALSE, fig.align='center', fig.cap="Table 3: Summary Statistics of Energy Sources Per Region"}
summary.table.fuels
```

\newpage

### References

[Project repository on GitHub](https://github.com/Srishtimutha/EDA_Class_Project_Sp23)

1. https://en.wikipedia.org/wiki/List_of_regions_of_the_United_States
2. https://www.epa.gov/egrid/download-data
3. https://www.cdc.gov/nchs/fastats/state-and-territorial-data.htm
4. https://data.census.gov/table?t=Age+and+Sex&g=010XX00US$0400000&y=2020&tid=ACSST5Y2020.S0101&moe=false
5. https://data.census.gov/table?t=Education&g=010XX00US$0400000&y=2020&tid=ACSST5Y2020.S1501&moe=false
6. https://data.census.gov/table?t=Income+and+Poverty&g=010XX00US$0400000&y=2020&tid=ACSST5Y2020.S1901&moe=false
7. https://aqs.epa.gov/aqsweb/airdata/annual_aqi_by_county_2021.zip

