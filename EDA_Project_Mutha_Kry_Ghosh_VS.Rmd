---
title: "Analysis of power generation across USA in 2021"
author: "Srishti Mutha, Sokna Kry, Samriddha Ghosh, Nagarajan Vaidya Subramanian"
date: "Spring 2023"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
geometry: margin=2.54cm
fig_caption: yes
---
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r installing packages, include=FALSE}
if(!require(knitr)) {
  install.packages("knitr")
  require(knitr)
}

if(!require(psych)) {
  install.packages("psych")
  require(psych)
}

if(!require(tidyverse)) {
  install.packages("tidyverse")
  require(tidyverse)
}

if(!require(gt)) {
  install.packages("gt")
  require(gt)
}
#dependency of gt
if(!require(xfun)) {
  install.packages("xfun")
  require(xfun)
}


```


```{r setup, include=FALSE}
# Set your working directory
getwd()
# Load your packages
library(knitr) #library of code that helps make pretty rendered docs
library(psych) #really only here for the skew function for summary stats
library(tidyverse) #dplyr, ggplot, and a bunch of other useful libraries
library(gt) #to make pretty looking summary tables

# Set your ggplot theme
my_theme <- theme_minimal() +
  theme(
    legend.position = "bottom",
    legend.title = element_text(colour = "#440000"),
    plot.title = element_text(colour = "blue",
                              hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    axis.title = element_text(colour = "#4169e1")
  )
theme_set(my_theme)
# Load your datasets
#Source of data is eGRID 2021, accessible from EPA's website at:
#https://www.epa.gov/system/files/documents/2023-01/eGRID2021_data.xlsx
egrid2021 <- readxl::read_xlsx(path = "./Data/Raw/eGRID2021_data.xlsx",
                               sheet = "ST21",
                               skip = 1)

#eGRID is a huge dataset with several data fields and we will only be using a subset of them.
#so this next line is to subset the database and select only those fields that we will be working with.
egrid_subset <- egrid2021 %>%
  select(PSTATABB, STNAMEPCAP, STNGENAN, STNOXAN, STSO2AN, STCO2AN,
         STCO2EQA, STGENACL, STGENAOL, STGENAGS, STGENANC, STGENAHY,
         STGENABM, STGENAWI, STGENASO, STGENAGT, STGENAOF, STGENATR, STGENATN)

#Creating a new blank column to represent the region that each state is from
#based on the classification system used by Bureau of Economic Analysis
egrid_subset <- egrid_subset %>%
  add_column(.before = "PSTATABB",
             Region = "blank")

#Source for the following classification of states into regions:
#https://apps.bea.gov/regional/docs/msalist.cfm?mlist=2
NewEngland <- c("CT", "ME", "MA", "NH", "RI", "VT")
MidEast <- c("DE", "DC", "MD", "NJ", "NY", "PA")
GreatLakes <- c("IL", "IN", "MI", "OH", "WI")
Plains <- c("IA", "KS", "MN", "MO", "NE", "ND", "SD")
SouthEast <- c("AL", "AR", "FL", "GA", "KY", "LA", "MS", "NC", "SC", "TN", "VA", "WV")
SouthWest <- c("AZ", "NM", "OK", "TX")
RockyMountain <- c("CO", "ID", "MT", "UT", "WY")
FarWest <- c("CA", "HI", "NV", "OR", "WA")

#this next one is not a classification used by BEA but one that is useful for analysing this dataset
NonContiguous <- c("AK", "PR") 

egrid_subset$Region[egrid_subset$PSTATABB %in% NewEngland] <- "New England"
egrid_subset$Region[egrid_subset$PSTATABB %in% MidEast] <- "Mid East"
egrid_subset$Region[egrid_subset$PSTATABB %in% GreatLakes] <- "Great Lakes"
egrid_subset$Region[egrid_subset$PSTATABB %in% Plains] <- "Plains"
egrid_subset$Region[egrid_subset$PSTATABB %in% SouthEast] <- "South East"
egrid_subset$Region[egrid_subset$PSTATABB %in% SouthWest] <- "South West"
egrid_subset$Region[egrid_subset$PSTATABB %in% RockyMountain] <- "Rocky Mountain"
egrid_subset$Region[egrid_subset$PSTATABB %in% FarWest] <- "Far West"
egrid_subset$Region[egrid_subset$PSTATABB %in% NonContiguous] <- "Non-Contiguous"

egrid_subset$Region == "blank" #verifying that all states have been categorized

#uncomment this code when there's any changes to the subsetting
#write.csv(egrid_subset, file = "./Data/Processed/egrid2021_st21_processed.csv")

```


# Rationale and Research Questions
The US has been transitioning towards a greater reliance on renewable energy sources such as wind, solar, hydro power and many more technologies. Analyzing the e-Grid data can provide insights into the distribution of clean energy generation across US, performance of these renewable energy sources, their impact on the electricity generation and energy markets throughout USA, and whether they are meeting the expectations of energy companies, policymakers, and consumers. 

This project aims to use e-GRID 2021 (published January 2023) to answer the following research questions:

1. What is the distribution of electricity generation across the Bureau of Economic Analysis regions in the US, from both the renewable and non-renewable energy sources?
2. What is the distribution of generation from each type of renewable and non-renewable energy sources across Bureau of Economic Analysis regions in the US?
3. Greenhouse gas emissions across Bureau of Economic Analysis regions in the US from electricity generators. 
4. Summary statistics of generators across the Bureau of Economic Analysis regions in the US, in terms of fuel source, nameplate capacity, annual net generation, and pollutants emitted?
5. Is there correlation between energy generators and pollutants emitted? 

These analyses will be performed by aggregating the states into categories as done by the Bureau of Economic Analysis which divides the states into 8 regions. We have added an additional "Non-Contiguous" category to represent states in the e-GRID dataset that are not part of mainland USA.

\newpage

# Dataset Information
The Emissions & Generation Resource Integrated Database (e-GRID) is a comprehensive source of data published by the Environment Protection Agency of the US Government.  This database describes various technical and environmental parameters of all electric power plants in the US, and is published annually. It includes emissions, emission rates, generation, heat input, resource mix, and many other attributes. eGRID is typically used for greenhouse gas registries and inventories, carbon footprints, consumer information disclosure, emission inventories and standards, power market changes, and avoided emission estimates.In our project we have used the e-Grid 2021 data-set which was released on January 30th, 2023. 

Below are some summary statistics of the installed capacity and annual generation per region, pollutants and their CO2 equivalents per region, and lastly about the distribution of annual generation across different renewable and non-renewable sources of energy.

\newpage


# Exploratory Analysis 

```{r summary.stats, include=FALSE}

#summary stats of total nameplate capacity and annual generation per region
summary.plants <- egrid_subset %>%
  select(Region, STNAMEPCAP, STNGENAN) %>%
  rename("State nameplate capacity (MW)" = STNAMEPCAP,
         "State annual net generation (MWh)" = STNGENAN) %>%
  pivot_longer(cols = c("State nameplate capacity (MW)",
                        "State annual net generation (MWh)"),
               names_to = "variable", values_to = "value") %>%
  group_by(Region, variable) %>%
  summarise(obs = length(value[!is.na(value)]),
            min = round(min(value, na.rm = TRUE), 2),
            max = round(max(value, na.rm = TRUE), 2),
            mean = round(mean(value, na.rm =TRUE), 2),
            median = round(median(value, na.rm =TRUE), 2),
            sd = round(sd(value, na.rm =TRUE), 2),
            skewness = round(skew(value,na.rm = TRUE), 2))

#summary stats of region-wise emission of different pollutants and the CO2 equivalents
 
summary.pollution <- egrid_subset %>%
  select(Region, STNOXAN, STSO2AN, STCO2AN, STCO2EQA) %>%
  rename("State annual NOx emissions (tons)" = STNOXAN,
         "State annual SO2 emissions (tons)" = STSO2AN,
         "State annual CO2 emissions (tons)" = STCO2AN,
         "State annual CO2 equivalent emissions (tons)" = STCO2EQA) %>%
  pivot_longer(cols = c("State annual NOx emissions (tons)",
                        "State annual SO2 emissions (tons)",
                        "State annual CO2 emissions (tons)",
                        "State annual CO2 equivalent emissions (tons)"),
               names_to = "variable", values_to = "value") %>%
  group_by(Region, variable) %>%
  summarise(obs = length(value[!is.na(value)]),
            min = round(min(value, na.rm = TRUE), 2),
            max = round(max(value, na.rm = TRUE), 2),
            mean = round(mean(value, na.rm = TRUE), 2),
            median = round(median(value, na.rm=TRUE), 2),
            sd = round(sd(value, na.rm=TRUE), 2),
            skewness = round(skew(value, na.rm = TRUE), 2))

#summary stats of region-wise breakdown of generation by fuel type
summary.fuels <- egrid_subset %>%
  select(Region, STGENACL, STGENAOL, STGENAGS, STGENANC, STGENAHY,
         STGENABM, STGENAWI, STGENASO, STGENAGT, STGENAOF) %>%
  rename("State annual coal net generation (MWh)" = STGENACL,
         "State annual oil net generation (MWh)" = STGENAOL,
         "State annual gas net generation (MWh)" = STGENAGS,
         "State annual nuclear net generation (MWh)" = STGENANC,
         "State annual hydro net generation (MWh)" = STGENAHY,
         "State annual biomass net generation (MWh)" = STGENABM,
         "State annual wind net generation (MWh)" = STGENAWI,
         "State annual solar net generation (MWh)" = STGENASO,
         "State annual geothermal net generation (MWh)" = STGENAGT,
         "State annual other fossil net generation (MWh)" = STGENAOF) %>%
  pivot_longer(cols = c("State annual coal net generation (MWh)",
                        "State annual oil net generation (MWh)",
                        "State annual gas net generation (MWh)",
                        "State annual nuclear net generation (MWh)",
                        "State annual hydro net generation (MWh)",
                        "State annual biomass net generation (MWh)",
                        "State annual wind net generation (MWh)",
                        "State annual solar net generation (MWh)",
                        "State annual geothermal net generation (MWh)",
                        "State annual other fossil net generation (MWh)"),
               names_to = "variable", values_to = "value") %>%
  group_by(Region, variable) %>%
  summarise(obs = length(value[!is.na(value)]),
            min = round(min(value, na.rm = TRUE), 2),
            max = round(max(value, na.rm = TRUE), 2),
            mean = round(mean(value, na.rm=TRUE), 2),
            median = round(median(value, na.rm=TRUE), 2),
            sd = round(sd(value, na.rm=TRUE), 2),
            skewness = round(skew(value, na.rm = TRUE), 2))

```

```{r summary.tables, include=FALSE}
summary.table.plants <- summary.plants %>%
  gt() %>%
    tab_options(table.width = pct(95)) %>%
    cols_width(c(variable)~ px(200),
               everything()~ px(120) )%>%

  # tab_header(
  #   title = md("Table 1: Summary Statistics for Variables per Region")) %>%

  fmt_passthrough (columns=c(Region)) %>%
  fmt_number(columns=c(obs), decimals=0) %>%

  fmt_number(
    columns = 3:7,
    rows = all(),
    n_sigfig = 1,
    sep_mark = ",") %>%

  cols_label(variable="Variable",
    obs = "Observations",
    min = "Minimum",
    max = "Maximum",
    mean = "Mean",
    median="Median",
    sd = "Standard Deviation",
    skewness = "Skewness")

summary.table.plants

summary.table.pollution <- summary.pollution %>%
  gt() %>%
    tab_options(table.width = pct(95)) %>%
    cols_width(c(variable)~ px(200),
               everything()~ px(120) )%>%

  # tab_header(
  #   title = md("Table 2: Summary Statistics of pollutants emitted per Region")) %>%

  fmt_passthrough (columns=c(Region)) %>%
  fmt_number(columns=c(obs), decimals=0) %>%

  fmt_number(
    columns = 3:7,
    rows = all(),
    n_sigfig = 1,
    sep_mark = ",") %>%

  cols_label(variable="Variable",
    obs = "Observations",
    min = "Minimum",
    max = "Maximum",
    mean = "Mean",
    median="Median",
    sd = "Standard Deviation",
    skewness = "Skewness")

summary.table.pollution

summary.table.fuels <- summary.fuels %>%
  gt() %>%
    tab_options(table.width = pct(95)) %>%
    cols_width(c(variable)~ px(200),
               everything()~ px(120) )%>%

  # tab_header(
  #   title = md("Table 3: Summary Statistics of Energy Sources Per Region")) %>%

  fmt_passthrough (columns=c(Region)) %>%
  fmt_number(columns=c(obs), decimals=0) %>%

  fmt_number(
    columns = 3:7,
    rows = all(),
    n_sigfig = 1,
    sep_mark = ",") %>%

  cols_label(variable="Variable",
    obs = "Observations",
    min = "Minimum",
    max = "Maximum",
    mean = "Mean",
    median="Median",
    sd = "Standard Deviation",
    skewness = "Skewness")

summary.table.fuels

```

\newpage

# Analysis
## Question 1: What is the distribution of electricity generation across the Bureau of Economic Analysis regions in the US, from both the renewable and non-renewable energy sources?
```{r Research.Question.1, include=FALSE}

generation_rene<-aggregate(egrid_subset$STGENATR, by=list(egrid_subset$Region), FUN=sum)
generation_rene

generation_nonrene<-aggregate(egrid_subset$STGENATN , by=list(egrid_subset$Region), FUN=sum)
generation_nonrene

colnames(generation_rene) <- c("Region", "Total renewable generation (MWh)")
colnames(generation_nonrene) <- c("Region", "Total non-renewable generation (MWh)")

#bar plot
<<<<<<< HEAD
=======
energy.sources <- merge(generation_rene, generation_nonrene) %>%
  pivot_longer(cols = c("Total renewable generation (MWh)", "Total non-renewable generation (MWh)"),
               names_to = "source",
               values_to = "values") %>%
  mutate(source = as.factor(source))

energy.sources.plot <- energy.sources %>%
    ggplot(mapping = aes(x = Region,
                         y = values,
                         fill = source)) +
    geom_bar(stat = "identity",
             position = 'dodge') +
    labs(title = "Distribution of Energy Sources by Region in 2021",
         x = "Regions",
         y = "Total Power Generation (MWh)") +
    theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
energy.sources.plot

>>>>>>> c8dbaadde83c091ef5c92f938f98c13816e04bf5
```

## Question 2: What is the distribution of generation from each type of renewable energy sources across Bureau of Economic Analysis regions in the US?
```{r Research.Question.2, include=FALSE}

distribution_rene<-aggregate(cbind(STGENAHY,STGENABM,STGENAWI,STGENASO,STGENAGT) ~ Region,data=egrid_subset, FUN=sum)
colnames(distribution_rene) <- c("Region","Hydro-power generation (MWh)","Biomass generation (MWh) ","Wind generation (MWh)","Solar generation (MWh)","Geothermal generation (MWh)")

table.annualgen <- kable(distribution_rene, align = c("l", rep("c", 7)))

distribution_nonrene<-aggregate(cbind(STGENACL,STGENAOL,STGENAGS,STGENANC) ~ Region,data=egrid_subset, FUN=sum)
print(distribution_nonrene)

colnames(distribution_nonrene) <- c("Region","Coal generation (MWh)","Oil generation (MWh)","Natural Gas generation (MWh)","Nuclear generation (MWh)")



```

## Question 3: Greenhouse gas emissions across Bureau of Economic Analysis regions in the US from electricity generators.
```{r Research.Question.3, echo=FALSE, fig.cap="Total CO2 and CO2 eq emissions across regions", fig.align='center'}
pollutants.plot <- 
  egrid_subset %>%
  select(Region, STCO2EQA, STCO2AN) %>%
  group_by(Region) %>%
  mutate(STCO2EQA = STCO2EQA - STCO2AN) %>%
  summarise("Total CO2 emissions" = sum(STCO2AN),
            "Total CO2 equivalents emissions" = sum(STCO2EQA)) %>%
  pivot_longer(cols = c("Total CO2 emissions",
                        "Total CO2 equivalents emissions"),
               names_to = "variable",
               values_to = "values") %>%
  ggplot(mapping = aes(x = Region,
                       y = values,
                       fill = variable)) +
    geom_bar(stat = "identity",
             position = position_stack(reverse = TRUE)) +
    labs(title = "Total CO2 and CO2 eq emissions across regions",
         x = "Regions",
         y = "Emissions (tons)",
         fill = "Emission category") +
    theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
pollutants.plot
ggsave(filename = "./Plots/Q3_pollutants_plot.png",
       plot = pollutants.plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')
```


## Question 4: Summary statistics of generators across the Bureau of Economic Analysis regions in the US, in terms of fuel source, nameplate capacity, annual net generation, and pollutants emitted?
```{r Research Question 4, echo=FALSE, fig.align='center'}
# Boxplot
CO2_Plot <- ggplot(egrid_subset, aes(x = Region, y = STCO2AN)) + 
  geom_boxplot()+
  labs (title= expression(paste("CO"[2]~"Emissions in each Region in the USA in 2021")), 
        y= expression(paste("CO"[2]~"Emissions (tons)")),
        x= "Regions") +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
CO2_Plot
ggsave(filename = "./Plots/Q4_CO2_Plot.png",
       plot = pollutants.plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')

SO2_Plot <- ggplot(egrid_subset, aes(x = Region, y = STSO2AN)) + 
  geom_boxplot()+
  labs (title= expression(paste("SO"[2]~"Emissions in each Region in the USA in 2021")), 
        y= expression(paste("SO"[2]~"Emissions (tons)")),
        x= "Regions") +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
SO2_Plot
ggsave(filename = "./Plots/Q4_SO2_Plot.png",
       plot = pollutants.plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')

NOX_Plot<-ggplot(egrid_subset, aes(x = Region, y = STNOXAN)) + 
  geom_boxplot()+
  labs (title= expression(paste("NO"[X]~"Emissions in each Region in the USA in 2021")), 
        y= expression(paste("NO"[X]~"Emissions (tons)")),
        x= "Regions")+
  theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
NOX_Plot
ggsave(filename = "./Plots/Q4_NOX_Plot.png",
       plot = pollutants.plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')

CO2EQA_Plot<-ggplot(egrid_subset, aes(x = Region, y = STCO2EQA)) + 
  geom_boxplot()+
  labs (title= expression(paste("CO"[2]~"EQ Emissions in each Region in the USA in 2021")), 
        y= expression(paste("CO"[2]~"EQ Emissions (tons)")),
        x= "Regions")+
  theme(axis.text.x = element_text(angle = 45, hjust = 0.75))
CO2EQA_Plot
ggsave(filename = "./Plots/Q4_CO2EQA_Plot.png",
       plot = pollutants.plot,
       dpi = 'retina',
       bg = '#f6efdcff',
       device = 'png')


```

## Question 5: Is there correlation between energy generators and pollutants emitted? 
Ho: There is no correlation between energy generators and pollutants emitted
Ha: There is correlation between energy generators and pollutants emitted

```{r Research Question 5}
#T.Test

T_GENOX <- lm(egrid_subset$STNGENAN ~ egrid_subset$STNOXAN)
summary(T_GENOX)

T_GESO2 <-lm(egrid_subset$STNGENAN ~ egrid_subset$STSO2AN)
summary(T_GESO2)

T_GECO2 <- lm(egrid_subset$STNGENAN ~ egrid_subset$STCO2AN)
summary(T_GECO2)

T_GECO2EQA <- lm(egrid_subset$STNGENAN ~ egrid_subset$STCO2EQA)
summary(T_GECO2EQA)
```


\newpage

# Summary and Conclusions


\newpage

# Appendix

```{r summary.table.plants, echo=FALSE, fig.align='center', fig.cap="Table 1: Summary Statistics for Variables per Region"}
summary.table.plants
```

```{r summary.table.pollution, echo=FALSE, fig.align='center', fig.cap="Table 2: Summary Statistics of Pollutants Emitted per Region"}
summary.table.pollution
```

```{r summary.table.fuels, echo=FALSE, fig.align='center', fig.cap="Table 3: Summary Statistics of Energy Sources Per Region"}
summary.table.fuels
```

# References
<add references here if relevant, otherwise delete this section> 
